/*!
	openModal.js
	(c) Alex Fischer
	https://github.com/a-p-f/openModal
	https://github.com/a-p-f/openModal/blob/master/LICENSE
*/
!function(){"use strict";var e,t,o,n,a,i,r,s,d,l,c;function u(o,n,a){e=function(){var e=document.activeElement;try{for(;e&&e.contentDocument&&e.contentDocument.activeElement;)e=e.contentDocument.activeElement}catch(e){}return e}(),addEventListener("click",h,!0),document.body.addEventListener("focus",m,!0);var i=(t=document.createElement("iframe")).style;return i.position="fixed",i.top=0,i.left=0,i.width="100%",i.height="100%",i.border="none",i.margin=0,i.padding=0,i.zIndex=9007199254740991,t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),document.body.appendChild(t),n&&(t.style.background=n),t.addEventListener("load",(function(e){a&&a(t.contentWindow)})),t.src=o,t}function h(e){e.stopPropagation(),e.preventDefault()}function m(){document.activeElement!=t&&t.focus()}function p(){var e=document.documentElement,t=e.style,r=document.body.style;a=r.overflowX,i=r.overflowY,o=t.width,n=t.height,t.width=e.clientWidth+"px",t.height=e.clientHeight+"px",r.overflowX="hidden",r.overflowY="hidden"}function f(){var c,u;t&&(t.parentElement.removeChild(t),removeEventListener("click",h,!0),document.body.removeEventListener("focus",m,!0),e&&e.focus(),e=null,t=null),history.replaceState(l,"",location.href),c=document.documentElement.style,(u=document.body.style).overflowY=i,u.overflowX=a,c.width=o,c.height=n,r(s),d&&d(s)}function w(){return window.parent!=window}function y(){return navigator.userAgent.indexOf("Trident/7.0")>-1}addEventListener("message",(function(e){var o=t;o&&e.source==o.contentWindow&&(e.data.modalChildTitled&&o.setAttribute("aria-label",e.data.modalChildTitled),"setModalCloseValue"in e.data&&_setOpenModalCloseValue(e.data.setModalCloseValue),"closeModalChild"in e.data&&f())})),window._setOpenModalCloseValue=function(e){s=e,t.contentWindow.postMessage("MODAL_CLOSE_VALUE_RECEIVED","*")},addEventListener("popstate",(function(){t&&f()})),window.openModal=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.background,a=void 0===n?null:n,i=o.onload,c=void 0===i?function(e){}:i,h=o.onclose,m=void 0===h?function(e){}:h;if(t)throw new Error("A modal window is already open. A window may only open one modal window at a time.");l=history.state,history.replaceState("PLACEHOLDER","",location.href),p(),r=m,s=void 0,u(e,a,c);try{return new Promise((function(e,t){d=e}))}catch(e){}},addEventListener("message",(function(e){e.source==window.parent&&"MODAL_CLOSE_VALUE_RECEIVED"==e.data&&(history.go(-1*parseInt(sessionStorage[c])),y()&&setTimeout(g,200))})),window.closeModal=function(e){if(!w())throw new Error("This is not a modal window");try{window.parent._setOpenModalCloseValue(e)}catch(t){window.parent.postMessage({setModalCloseValue:e},"*")}};var v,E=!1;function g(){E||(E=!0,window.parent.postMessage({closeModalChild:!0},"*"))}function S(e){try{return e in history.state}catch(e){return!1}}if(w()){if(window.name=window.name||"openModalWindow"+Date.now(),(c=window.name+"historyDepth")in sessionStorage)if(S(c))sessionStorage[c]=history.state[c];else if(function(){try{return"navigate"==performance.getEntriesByType("navigation")[0].type}catch(t){var e=performance.navigation;return e.type===e.TYPE_NAVIGATE}}()){var b=parseInt(sessionStorage[c])+1;sessionStorage[c]=b;var M=history.state||{};M[c]=b,history.replaceState(M,"",location.href)}else g();else{var C={};C[c]=1,history.pushState(C,"",location.href),sessionStorage[c]=1}v=history.pushState.bind(history),history.pushState=function(e,t,o){if(!e||"{"!=JSON.stringify(e)[0])throw new Error('Pages inside a modal window may use history.pushState, but they must pass a "simple object" (NOT Array, String, Number, null, etc.) as the state object');var n=history.state[c]+1;sessionStorage[c]=n,e[c]=n,v(e,t,o)},addEventListener("popstate",(function(){S(c)?y()&&history.state[c]==sessionStorage[c]?g():sessionStorage[c]=history.state[c]:g()})),function(){window.parent.postMessage({modalChildTitled:document.title},"*");var e=document.querySelector("[autofocus]");e?e.focus():(document.body.tabIndex=-1,document.body.focus())}()}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),document.addEventListener("click",(function(e){var t=e.target.closest("a[target=_modal]");t&&(e.ctrlKey||e.shiftKey||e.metaKey||e.defaultPrevented||(e.preventDefault(),openModal(t.href)))}))}();
