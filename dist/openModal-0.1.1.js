/*!
	openModal.js
	(c) Alex Fischer
	https://github.com/a-p-f/openModal
	https://github.com/a-p-f/openModal/blob/master/LICENSE
*/
!function(){"use strict";var e,t,o,n,a,r,i,s,d,l,c,u,m;function f(o,n,a){e=function(){var e=document.activeElement;try{for(;e&&e.contentDocument&&e.contentDocument.activeElement;)e=e.contentDocument.activeElement}catch(e){}return e}(),addEventListener("click",p,!0),document.body.addEventListener("focus",h,!0);var r=(t=document.createElement("iframe")).style;return r.position="fixed",r.top=0,r.left=0,r.width="100%",r.height="100%",r.border="none",r.margin=0,r.padding=0,r.zIndex=9007199254740991,t.setAttribute("role","dialog"),t.setAttribute("aria-modal","true"),document.body.appendChild(t),n&&(t.style.background=n),t.addEventListener("load",(function(e){a&&a(t.contentWindow)})),t.src=o,t}function p(e){e.stopPropagation(),e.preventDefault()}function h(){document.activeElement!=t&&t.focus()}function w(){var e=document.documentElement,t=e.style,d=document.body.style;n=d.overflowX,a=d.overflowY,o=t.maxWidth,r=e.scrollTop,i=e.scrollLeft,s=!0,t.maxWidth=e.clientWidth+"px",d.overflowX="hidden",d.overflowY="hidden"}function y(){var r,i;t&&(t.parentElement.removeChild(t),removeEventListener("click",p,!0),document.body.removeEventListener("focus",h,!0),e&&e.focus(),e=null,t=null),history.replaceState(u,"",location.href),r=document.documentElement.style,i=document.body.style,s=!1,i.overflowY=a,i.overflowX=n,r.maxWidth=o,d(l),c&&c(l)}function v(){return window.parent!=window}function E(){return navigator.userAgent.indexOf("Trident/7.0")>-1}addEventListener("scroll",(function(){s&&(document.documentElement.scrollTop=r,document.documentElement.scrollLeft=i)})),addEventListener("message",(function(e){var o=t;o&&e.source==o.contentWindow&&(e.data.modalChildTitled&&o.setAttribute("aria-label",e.data.modalChildTitled),"setModalCloseValue"in e.data&&_setOpenModalCloseValue(e.data.setModalCloseValue),"closeModalChild"in e.data&&y())})),window._setOpenModalCloseValue=function(e){l=e,t.contentWindow.postMessage("MODAL_CLOSE_VALUE_RECEIVED","*")},addEventListener("popstate",(function(){t&&y()})),window.openModal=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.background,a=void 0===n?null:n,r=o.onload,i=void 0===r?function(e){}:r,s=o.onclose,m=void 0===s?function(e){}:s;if(t)throw new Error("A modal window is already open. A window may only open one modal window at a time.");u=history.state,w(),d=m,l=void 0,f(e,a,i);try{return new Promise((function(e,t){c=e}))}catch(e){}},addEventListener("message",(function(e){e.source==window.parent&&"MODAL_CLOSE_VALUE_RECEIVED"==e.data&&(history.go(-1*parseInt(sessionStorage[m])),E()&&setTimeout(M,200))})),window.closeModal=function(e){if(!v())throw new Error("This is not a modal window");try{window.parent._setOpenModalCloseValue(e)}catch(t){window.parent.postMessage({setModalCloseValue:e},"*")}};var g=!1;window.isFirstModalLoad=function(){return g};var S,b=!1;function M(){b||(b=!0,window.parent.postMessage({closeModalChild:!0},"*"))}function L(e){try{return e in history.state}catch(e){return!1}}if(v()){if(window.name=window.name||"openModalWindow"+Date.now(),(m=window.name+"historyDepth")in sessionStorage)if(L(m))sessionStorage[m]=history.state[m];else if(function(){try{return"navigate"==performance.getEntriesByType("navigation")[0].type}catch(t){var e=performance.navigation;return e.type===e.TYPE_NAVIGATE}}()){var C=parseInt(sessionStorage[m])+1;sessionStorage[m]=C;var A=history.state||{};A[m]=C,history.replaceState(A,"",location.href)}else M();else{var T={};T[m]=1,history.pushState(T,"",location.href),sessionStorage[m]=1,g=!0}S=history.pushState.bind(history),history.pushState=function(e,t,o){if(!e||"{"!=JSON.stringify(e)[0])throw new Error('Pages inside a modal window may use history.pushState, but they must pass a "simple object" (NOT Array, String, Number, null, etc.) as the state object');var n=history.state[m]+1;sessionStorage[m]=n,e[m]=n,S(e,t,o)},addEventListener("popstate",(function(){L(m)?E()&&history.state[m]==sessionStorage[m]?M():sessionStorage[m]=history.state[m]:M()})),function(){window.parent.postMessage({modalChildTitled:document.title},"*");var e=document.querySelector("[autofocus]");e?e.focus():(document.body.tabIndex=-1,document.body.focus())}()}Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}),document.addEventListener("click",(function(e){var t=e.target.closest("a[target=_modal]");t&&(e.ctrlKey||e.shiftKey||e.metaKey||e.defaultPrevented||(e.preventDefault(),openModal(t.href)))}))}();
